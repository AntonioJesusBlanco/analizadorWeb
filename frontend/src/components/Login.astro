---
import Layout from '../layouts/Layout.astro';
---

<Layout>
     <div class="d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow p-4" style="width: 100%; max-width: 400px;">
      <h1 class="h4 text-center mb-3">Login</h1>
      <input id="username" class="form-control mb-2" placeholder="Usuario" />
      <input id="password" type="password" class="form-control mb-3" placeholder="Contraseña" />
      <button id="registerBtn" class="btn btn-primary w-100 mb-2">Entrar</button>
      <p id="msg" class="text-danger text-center"></p>
    </div>
  </div>

    <script type="module">

    // Puedes usar la URL directamente desde config.js
  const btn = document.getElementById('registerBtn');
  const msg = document.getElementById('msg') ;

  btn.addEventListener('click', async () => {
        const usernameInput = document.getElementById("username");
        const passwordInput = document.getElementById("password");
        const username = usernameInput.value;
        const password = passwordInput.value;


      const API_URL = "http://localhost:3000/api"; // apunta a tu backend
        try {
          const res = await fetch(`${API_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
          });

          const data = await res.json();

          if (data.token) {
            localStorage.setItem("token", data.token);
            window.location.href = "/dashboard"; // ajusta a tu ruta real
          } else {
            document.getElementById("msg").textContent = data.error || "Error desconocido";
          }
        } catch (err) {
          document.getElementById("msg").textContent = "Error de conexión al servidor";
          console.error(err);
        }
      });
    
    </script>
</Layout>